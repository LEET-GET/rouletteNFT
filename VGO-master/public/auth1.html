<html>
    <head>

        <link href="drawables/favicon.ico" rel="shortcut icon" type="image/x-icon" />
        <link rel="stylesheet" href="css/index.css" type="text/css">  
        <title> Authorization </title>
    </head> 
    <body> 
      <div class="navbar-brand">
        <a class="logoItem navbar-item draw-bottom">
                <img src="drawables/logo2.png" class="mainLogo">
        </a>
    </div>
    
    <nav class="navbar is-fixed-top is-transparent" role="navigation" aria-label="main navigation"> 
        <div class="navbar-brand">
            <a class="logoItem navbar-item draw-bottom">
                    <img src="drawables/logo2.png" class="mainLogo">
            </a>
            <div id ="mobileToggle" class="navbar-burger burger">
                <span class="mobileIcon"></span>
                <span class="mobileIcon"></span>
                <span class="mobileIcon"></span>
            </div>
        </div>
        <div class="navbar-menu" id="navMenu">
            <div class="navbar-start navSide">
                    <a class="navbar-item draw-bottom case-opening" href="https://roulettenft.onrender.com/">
                        <span class="icon">
                            <img class="caseIcon" src="drawables/Anderson-Web-Icons_Inventory-Management_3_Custom-Consignment-1.png">
                        </span>
                        <p id="navCaseOpening">
                            Case Opening
                        </p>
                      </a>
                    <div class="navbar-item draw-bottom inventory">
                        <span class="icon">
                            <img src="drawables/2551-200.png">
                        </span>
                        <p id="navInventory">
                            Inventory
                        </p>
                    </div>
                    <div class="navbar-item draw-bottom affiliates">
                        <span class="icon">
                            <img src="drawables/affiliates.png">
                        </span>
                        <p id="navAffiliates">
                            Affiliates
                        </p>
                      </div></nav>





       <div class="form-container">
    <!-- Registration Form -->
    <div class="register-form">
        <h2>Register</h2>
        <form id="registrationForm">
            <input type="email" id="registerEmail" placeholder="Email" required>
            <input type="password" id="registerPassword" placeholder="Password" required>
            <button type="submit" id="registerBtn">Register</button>
        </form>
    </div>
  
    <!-- Login Form -->
    <div class="login-form">
        <h2>Login</h2>
        <form id="loginForm">
            <input type="email" id="loginUsername" placeholder="Email" required>
            <input type="password" id="loginPassword" placeholder="Password" required>
            <button type="submit" id="loginBtn">Login</button>
        </form>
    </div>
</div>
<div id="userProfile">
    <h2>User Profile</h2>
    <div>Email: <span id="userEmail"></span></div>
    <div>Username: <span id="userName"></span></div>
    <div>Date Joined: <span id="userDateJoined"></span></div>
    <div>First Name: <span id="userFirstName"></span></div>
    <div>Last Name: <span id="userLastName"></span></div>
    <div>Balance: <span id="userBalance"></span></div>
</div>




<script>
  // Prevent form submission default action and handle registration
document.getElementById('registrationForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;

    fetch('http://209.38.248.1:8001/user/register/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email: email, password: password })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Registration Success:', data);
    })
    .catch((error) => {
        console.error('Registration Error:', error);
    });
});

// Prevent form submission default action and handle login
document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;

    fetch('http://209.38.248.1:8001/user/login/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ username: username, password: password })
    })
    .then(response => {
        if (!response.ok) throw new Error('Login failed');
        return response.json();
    })
    .then(data => {
        localStorage.setItem('accessToken', data.access);
        console.log('Login successful, fetching profile...');
        fetchUserProfile(); // Fetch user profile immediately after successful login
        window.location.href = 'https://roulettenft.onrender.com/profile.html';
        fetchUserProfile(); 
    })
    .catch((error) => {
        console.error('Login Error:', error);
        
    });
});
fetchUserProfile(); 







function fetchUserProfile() {
    const accessToken = localStorage.getItem('accessToken');
    fetch('http://209.38.248.1:8001/user/profile/', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) throw new Error('Failed to fetch profile');
        return response.json();
    })
    .then(data => {
        document.getElementById('userEmail').textContent = data.email;
        document.getElementById('userName').textContent = data.username;
        document.getElementById('userDateJoined').textContent = data.date_joined;
        document.getElementById('userFirstName').textContent = data.first_name;
        document.getElementById('userLastName').textContent = data.last_name;
        document.getElementById('userBalance').textContent = data.bill.amount;
    })
    .then(data => {
        const userBalance = document.getElementById('userBalance');
        if (userBalance) {
            userBalance.style.display = 'block';
            userBalance.textContent = `Balance: ${data.bill.amount}`;
        }
    })
    .catch((error) => {
        console.error('Profile Fetch Error:', error);
    });
}


</script>
<script src="server.js"></script>
<script type="text/javascript" src="js/client.js"></script>



</html>